<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog - Pedagogia Moderna</title>
    <style>
        :root { --primary: #6b46c1; --text: #2d3748; --light: #edf2f7; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #fdfbff; color: var(--text); }
        
        /* Navigazione */
        nav { background: white; padding: 20px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; }
        nav a { margin: 0 15px; text-decoration: none; color: var(--primary); font-weight: bold; transition: 0.3s; }
        nav a:hover { color: #44337a; }

        .main-container { max-width: 1200px; margin: 40px auto; display: grid; grid-template-columns: 1fr 350px; gap: 40px; padding: 0 20px; }

        /* Articolo in Evidenza (Grande) */
        #featured-post { background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
        .featured-img { width: 100%; height: 450px; object-fit: cover; background: #eee; }
        .featured-content { padding: 40px; }
        .featured-content h1 { font-size: 36px; margin: 0 0 20px; color: var(--primary); }
        .featured-content p { font-size: 18px; line-height: 1.8; color: #4a5568; white-space: pre-wrap; }

        /* Sidebar (Barra laterale) */
        .sidebar { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); height: fit-content; }
        .sidebar h3 { border-bottom: 2px solid var(--light); padding-bottom: 10px; margin-top: 0; }
        .search-box { width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 20px; }
        
        .side-post { display: flex; gap: 15px; margin-bottom: 20px; cursor: pointer; padding: 10px; border-radius: 10px; transition: 0.2s; }
        .side-post:hover { background: var(--light); }
        .side-post img { width: 80px; height: 80px; border-radius: 8px; object-fit: cover; background: #eee; }
        .side-post-info h4 { margin: 0; font-size: 14px; color: var(--text); }
        .side-post-info span { font-size: 12px; color: #a0aec0; }

        @media (max-width: 900px) {
            .main-container { grid-template-columns: 1fr; }
            .sidebar { order: 2; }
        }
    </style>
</head>
<body>

    <nav>
        <a href="/">Home</a>
        <a href="/blog.html">Blog</a>
        <a href="/admin">Area Riservata</a>
    </nav>

    <div class="main-container">
        <article id="featured-post">
            <div id="featured-data">
                <div style="padding: 100px; text-align: center;">Caricamento articoli...</div>
            </div>
        </article>

        <aside class="sidebar">
            <h3>Cerca</h3>
            <input type="text" class="search-box" id="searchInput" placeholder="Filtra articoli..." onkeyup="filterPosts()">
            
            <h3>Altri Articoli</h3>
            <div id="posts-list">
                </div>
        </aside>
    </div>

    <script>
        const repo = "TUO_UTENTE/TUO_REPO"; // <--- METTI IL TUO REPO QUI
        let allPosts = [];

        async function loadPosts() {
            try {
                const response = await fetch(`https://api.github.com/repos/${repo}/contents/posts`);
                const files = await response.json();
                
                // Scarichiamo tutti i contenuti JSON
                const fetchPromises = files
                    .filter(f => f.name.endsWith('.json'))
                    .map(f => fetch(f.download_url).then(r => r.json()));
                
                allPosts = await Promise.all(fetchPromises);
                // Ordiniamo per data (piÃ¹ recente sopra)
                allPosts.sort((a, b) => new Date(b.date) - new Date(a.date));

                displayPosts(allPosts);
            } catch (e) {
                document.getElementById('featured-data').innerHTML = "Errore nel caricamento.";
            }
        }

        function displayPosts(posts) {
            if (posts.length === 0) return;

            // 1. Mostra il primo articolo in grande
            const featured = posts[0];
            document.getElementById('featured-data').innerHTML = `
                ${featured.image ? `<img src="${featured.image}" class="featured-img">` : ''}
                <div class="featured-content">
                    <span>${new Date(featured.date).toLocaleDateString('it-IT')}</span>
                    <h1>${featured.title}</h1>
                    <p>${featured.content}</p>
                </div>
            `;

            // 2. Mostra gli altri nella sidebar
            const list = document.getElementById('posts-list');
            list.innerHTML = '';
            posts.forEach((post, index) => {
                list.innerHTML += `
                    <div class="side-post" onclick="showPost(${index})">
                        <img src="${post.image || 'https://via.placeholder.com/80'}">
                        <div class="side-post-info">
                            <h4>${post.title}</h4>
                            <span>${new Date(post.date).toLocaleDateString('it-IT')}</span>
                        </div>
                    </div>
                `;
            });
        }

        function showPost(index) {
            // Sposta l'articolo cliccato in primo piano (semplice switch visivo)
            const selected = allPosts[index];
            document.getElementById('featured-data').innerHTML = `
                ${selected.image ? `<img src="${selected.image}" class="featured-img">` : ''}
                <div class="featured-content">
                    <span>${new Date(selected.date).toLocaleDateString('it-IT')}</span>
                    <h1>${selected.title}</h1>
                    <p>${selected.content}</p>
                </div>
            `;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function filterPosts() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allPosts.filter(p => p.title.toLowerCase().includes(query));
            displayPosts(filtered);
        }

        loadPosts();
    </script>
</body>
</html>